# üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤ —Å–∏—Å—Ç–µ–º–µ. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –Ω–∏–º–∏ –∏ –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

---

## ‚öôÔ∏è –û–±—â–∞—è —Å—Ö–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü:
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (—á–∏—Ç–∞—Ç–µ–ª–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏);
- `roles` ‚Äî —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
- `books` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–∞—Ö;
- `book_copies` ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–Ω–∏–≥;
- `borrowings` ‚Äî –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥;
- `reservations` ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç –≤ —á–∏—Ç–∞–ª—å–Ω–æ–º –∑–∞–ª–µ;
- `reading_room_visits` ‚Äî –ø–æ—Å–µ—â–µ–Ω–∏—è —á–∏—Ç–∞–ª—å–Ω–æ–≥–æ –∑–∞–ª–∞;
- `notifications` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

---

## üìä –¢–∞–±–ª–∏—Ü—ã –∏ –ø–æ–ª—è

### üë§ `users`
–°–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö.

| –ü–æ–ª–µ         | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ                        |
|--------------|----------------|---------------------------------|
| user_id      | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                  |
| firebase_uid | bigint         | UID –∏–∑ Firebase Auth            |
| email        | varchar        | email                           |
| first_name   | varchar        | –∏–º—è                             |
| last_name    | varchar        | —Ñ–∞–º–∏–ª–∏—è                         |
| phone        | varchar(20)?   | –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| role_id      | int?           | —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è               |
| is_active    | boolean        | –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å         |
| created_at   | timestamp?     | –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏            |
| updated_at   | timestamp      | –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ            |

üîó –°–≤—è–∑–∏:
- `role_id` ‚Üí `roles.role_id`
- `user_id` —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ `reservations`, `borrowings`, `reading_room_visits`, `notifications`

---

### üíº `roles`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–æ–ª–µ–π.

| –ü–æ–ª–µ      | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ            |
|-----------|----------------|---------------------|
| role_id   | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á      |
| role_name | varchar(50)    | –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏       |

---

### üìö `books`
–°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–±–ª–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–Ω–∏–≥–∞—Ö.

| –ü–æ–ª–µ            | –¢–∏–ø             | –û–ø–∏—Å–∞–Ω–∏–µ                        |
|------------------|----------------|---------------------------------|
| book_id          | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                  |
| title            | varchar        | –Ω–∞–∑–≤–∞–Ω–∏–µ                        |
| author           | varchar        | –∞–≤—Ç–æ—Ä                           |
| isbn             | varchar(20)?   | ISBN (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)              |
| publication_year | int?           | –≥–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏                  |
| publisher        | varchar?       | –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ                    |
| genre            | varchar?       | –∂–∞–Ω—Ä                            |
| description      | text?          | –æ–ø–∏—Å–∞–Ω–∏–µ                        |
| keywords         | text?          | –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞                  |
| coverUrl         | varchar        | —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É               |

üîó –°–≤—è–∑–∏:
- `book_id` ‚Üí `book_copies.book_id`
- `book_id` ‚Üí `reservations.book_id`

---

### üóÇÔ∏è `book_copies`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∫–Ω–∏–≥.

| –ü–æ–ª–µ         | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ                        |
|--------------|----------------|---------------------------------|
| copy_id      | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                  |
| book_id      | int            | —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–Ω–∏–≥—É                 |
| status       | varchar(50)?   | —Å—Ç–∞—Ç—É—Å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞               |
| location     | varchar?       | –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–ø–æ–ª–∫–∞, –∑–∞–ª)     |
| is_available | boolean?       | –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä           |

üîó –°–≤—è–∑–∏:
- `book_id` ‚Üí `books.book_id`
- `copy_id` —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ `borrowings`

---

### üìñ `borrowings`
–í—ã–¥–∞—á–∏ –∫–Ω–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

| –ü–æ–ª–µ         | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ                                          |
|--------------|----------------|---------------------------------------------------|
| borrowing_id | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                                    |
| copy_id      | int?           | —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–Ω–∏–≥–∏                         |
| user_id      | int?           | –∫—Ç–æ –≤–∑—è–ª –∫–Ω–∏–≥—É                                    |
| borrow_date  | timestamp?     | –¥–∞—Ç–∞ –≤—ã–¥–∞—á–∏                                       |
| due_date     | timestamp      | –¥–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É                          |
| return_date  | timestamp      | —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç                               |
| status       | varchar(50)?   | —Å—Ç–∞—Ç—É—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: –≤—ã–¥–∞–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ) |
| stuff_id     | int            | —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –≤—ã–¥–∞–≤—à–∏–π –∫–Ω–∏–≥—É                         |

üîó –°–≤—è–∑–∏:
- `user_id` ‚Üí `users.user_id`
- `copy_id` ‚Üí `book_copies.copy_id`

---

### üìÖ `reservations`
–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç –≤ —á–∏—Ç–∞–ª—å–Ω–æ–º –∑–∞–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

| –ü–æ–ª–µ                | –¢–∏–ø            | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|---------------------|----------------|---------------------------------------------|
| reservation_id      | int            | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                              |
| book_id             | int?           | ID –∫–Ω–∏–≥–∏                                    |
| user_id             | int?           | –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å                                |
| reservation_date    | timestamp?     | –∫–æ–≥–¥–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª                            |
| expiration_date     | timestamp      | —Å—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –±—Ä–æ–Ω–∏                        |
| status              | varchar(50)?   | —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏                        |
| count_of_placements | int            | —Å—á–µ—Ç—á–∏–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç                      |

üîó –°–≤—è–∑–∏:
- `user_id` ‚Üí `users.user_id`
- `book_id` ‚Üí `books.book_id`

---

### ü™ë `reading_room_visits`
–£—á–µ—Ç –ø–æ—Å–µ—â–µ–Ω–∏–π —á–∏—Ç–∞–ª—å–Ω–æ–≥–æ –∑–∞–ª–∞.

| –ü–æ–ª–µ       | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ               |
|------------|--------------|------------------------|
| visit_id   | int          | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á         |
| user_id    | int?         | —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| entry_time | timestamp?   | –≤—Ä–µ–º—è –≤—Ö–æ–¥–∞            |
| exit_time  | timestamp?   | –≤—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞           |

üîó –°–≤—è–∑–∏:
- `user_id` ‚Üí `users.user_id`

---

### üîî `notifications`
–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

| –ü–æ–ª–µ            | –¢–∏–ø        | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|-----------------|------------|-----------------------------|
| notification_id | int        | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á              |
| user_id         | int?       | –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ             |
| message         | text       | —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è           |
| created_at      | timestamp? | –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω–æ               |
| is_sent         | boolean?   | –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–∏               |

üîó –°–≤—è–∑–∏:
- `user_id` ‚Üí `users.user_id`

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —á–∏—Å–ª–æ–≤—ã–µ –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏;
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω—ã —Å–≤—è–∑—è–º–∏, –Ω–æ —è–≤–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ;
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –¥–æ–ø—É—Å–∫–∞—é—Ç `NULL`, –Ω–∞–ø—Ä–∏–º–µ—Ä `phone`, `role_id`, `return_date` ‚Äì —Å—Ç–æ–∏—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ API.

---

## üì∑ –î–∏–∞–≥—Ä–∞–º–º–∞

![ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](https://github.com/Ntditl/kpfu_service_library/blob/main/docs/erm_diagram_bd.png)

---

> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–Ω–∏–≥, –∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–¥–∞—á–∞, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ —É—á–µ—Ç –ø–æ—Å–µ—â–µ–Ω–∏–π —á–∏—Ç–∞–ª—å–Ω–æ–≥–æ –∑–∞–ª–∞.

